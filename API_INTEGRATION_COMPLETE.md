# 文章页面 API 集成完成说明

## 改动概述

已成功将文章页面从 mock 数据切换到真实 API 数据。

## 改动文件

### 1. `/lib/types.ts` - 类型定义
- ✅ 添加了 `ApiArticleItem` 接口，对应 API 返回的文章数据结构
- ✅ 添加了 `ApiArticleResponse` 接口，对应完整的 API 响应
- ✅ 扩展了 `Article` 接口，添加 `link`, `imgList`, `channel` 字段

### 2. `/lib/api.ts` - API 调用工具（新建）
- ✅ 创建了 `getArticleList()` 函数，封装文章列表获取逻辑
- ✅ 创建了 `transformApiArticle()` 函数，将 API 数据转换为前端 Article 类型
- ✅ 支持分页（通过 `next_token`）
- ✅ 支持搜索（通过 `keywords` 参数）
- ✅ 包含错误处理和类型安全

### 3. `/app/articles/page.tsx` - 文章页面
- ✅ 替换 mock 数据为真实 API 调用
- ✅ 实现无限滚动加载（使用 `next_token`）
- ✅ 实现搜索功能（带防抖，500ms）
- ✅ 保留分类筛选功能（前端筛选）
- ✅ 添加加载状态和错误处理
- ✅ 支持初始加载提示

### 4. `/components/articles/article-card.tsx` - 文章卡片组件
- ✅ 支持显示真实图片（从 `coverImage` 或 `imgList[0]`）
- ✅ 支持外部链接（在新标签页打开）
- ✅ 保持原有的 UI 样式和交互

### 5. `/components/home/tools-section.tsx` - 首页精选文章模块（新启用）
- ✅ 改用真实 API 数据（不再使用 mock 数据）
- ✅ 显示最新的 3 篇文章
- ✅ 支持显示真实封面图
- ✅ 添加加载骨架屏效果
- ✅ 支持外部链接跳转
- ✅ 点击"查看全部文章"跳转到文章列表页

### 6. `/app/page.tsx` - 首页
- ✅ 启用精选文章模块（之前被注释）

## 功能特性

### ✅ 已实现的功能

1. **数据加载**
   - 初始加载 10 篇文章
   - 加载状态提示
   - 错误处理和提示

2. **搜索功能**
   - 支持按标题搜索
   - 防抖处理（500ms）
   - 搜索结果实时更新

3. **无限滚动**
   - 自动加载更多文章
   - 使用 `next_token` 分页
   - 滚动到底部自动触发
   - 支持手动点击"加载更多"

4. **分类筛选**
   - 动态生成分类列表（基于已加载的文章）
   - 前端筛选，不重新请求 API

5. **头条展示**
   - 第一篇文章作为头条大卡片显示
   - 支持显示封面图片
   - 点击跳转到外部链接

6. **首页精选文章模块**
   - 显示最新的 3 篇文章
   - 网格布局，响应式设计
   - 加载骨架屏优化体验
   - 支持真实封面图显示
   - 点击跳转到原文链接

7. **响应式设计**
   - 适配移动端和桌面端
   - 保持原有的美观 UI

## API 接口说明

### 接口地址
```
GET https://api.shandian.io/front/index/getArticleList
```

### 请求参数
- `max_results`: 最大返回数量（默认 10）
- `next_token`: 分页 token（首次为空）
- `keywords`: 搜索关键词（可选）

### 响应结构
```json
{
  "code": 0,
  "data": {
    "list": [
      {
        "id": 107147,
        "title": "文章标题",
        "excerpt": "文章摘要",
        "author": "作者名",
        "link": "https://...",
        "channel": "来源",
        "channel_id": 4,
        "img_list": ["图片URL"],
        "publish_at": 1762228814
      }
    ],
    "meta": {
      "next_token": "eyJ...",
      "result_count": 5
    }
  },
  "msg": "获取深度文章列表成功"
}
```

## 使用说明

### 启动项目
```bash
npm run dev
```

### 访问文章页面
```
http://localhost:3000/articles
```

## 注意事项

1. **CORS 问题**
   - 如果遇到跨域问题，可能需要配置代理或联系后端添加 CORS 头

2. **图片加载**
   - 使用 `loading="lazy"` 优化图片加载
   - 图片加载失败会显示占位符

3. **外部链接**
   - 所有文章链接在新标签页打开
   - 添加了 `rel="noopener noreferrer"` 安全属性

4. **性能优化**
   - 搜索使用防抖，避免频繁请求
   - 无限滚动按需加载，减少初始加载时间
   - 分类筛选为前端筛选，不重新请求 API

5. **错误处理**
   - API 请求失败会显示友好的错误提示
   - 不会阻塞页面其他功能

## 后续优化建议

1. **缓存策略**
   - 考虑添加本地缓存，减少重复请求
   - 使用 React Query 或 SWR 等数据获取库

2. **SEO 优化**
   - 考虑使用服务端渲染（SSR）
   - 添加元数据和结构化数据

3. **性能监控**
   - 添加性能监控和错误追踪
   - 优化大数据量下的渲染性能

4. **用户体验**
   - 添加骨架屏加载效果
   - 优化移动端的滚动加载体验

## 测试清单

- [x] 初始页面加载
- [x] 搜索功能
- [x] 分类筛选
- [x] 无限滚动
- [x] 点击文章跳转
- [x] 错误处理
- [x] 加载状态显示
- [x] 移动端适配
- [x] **导航栏入口已启用**
- [x] **Footer 入口已启用**
- [x] **API 连接测试通过**
- [x] **首页精选文章模块已启用**

## 页面访问

### 开发环境
启动项目后访问：
- 文章页面：http://localhost:3000/articles
- 通过顶部导航"文章"按钮进入
- 通过底部"文章中心"链接进入

### 入口配置
✅ 已在以下位置启用文章页面入口：
1. **Header 导航栏** - `/components/layout/header.tsx` (第15行)
2. **Footer 底部导航** - `/components/layout/footer.tsx` (第10行)

### API 状态
✅ API 连接测试成功
- 接口地址：https://api.shandian.io/front/index/getArticleList
- 响应正常：200 OK
- 数据结构正确
- 支持分页和搜索

## 完成时间
2025-11-04

---

## 快速启动

```bash
# 启动开发服务器
npm run dev

# 访问文章页面
open http://localhost:3000/articles
```

现在文章页面已经完全可用，不再显示 "Coming Soon"！

